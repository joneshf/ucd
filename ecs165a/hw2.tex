\documentclass[12pt,letterpaper]{article}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{cancel}
\usepackage[bottom=1in,left=0.4in,right=1in,top=1in]{geometry}
\usepackage{titling}
\usepackage{multirow}
\usepackage{amssymb}
\usepackage{algorithm2e}
\usepackage{wasysym}
\usepackage{qtree}

\newcommand{\lb}[0]{\text{lg}}
\newcommand{\parens}[1]{\left(#1\right)}
\newcommand{\closure}[1]{\{#1\}^+}
\newcommand{\Ans}[0]{\text{Ans}}
\newcommand{\AND}[0]{\text{ AND }}
\newcommand{\OR}[0]{\text{ OR }}

\setlength{\droptitle}{-10ex}

\preauthor{\begin{flushright}\large \lineskip 0.5em}
\postauthor{\par\end{flushright}}
\predate{\begin{flushright}\large}
\postdate{\par\end{flushright}}

\title{ECS 165A Homework 2\vspace{-2ex}}
\author{Hardy Jones\\
        999397426\\
        Professor Nitta\vspace{-2ex}}
\date{Fall 2014}

\begin{document}
  \maketitle

  \begin{enumerate}
    \item
      \begin{enumerate}
        \item The keys are $\{A,B\}$ and $\{B,C\}$.

          We can see this by computing $\closure{A,B}$ and $\closure{B,C}$,
          seeing that no other combinations of attributes can be keys,
          and seeing that these are minimal.

          \[
            \closure{A,B} = \closure{A,B,C} = \closure{A,B,C,D} = \{A,B,C,D,E\}
          \]
          \[
            \closure{B,C} = \closure{B,C,E} = \closure{B,C,E,A} = \{B,C,E,A,D\}
          \]
        \item This is a minimal basis.

          \begin{proof}
            \begin{itemize}
              \item Each right hand side is a singleton.

              \item
                We have three FD's with 2 attributes on the left.
                We check to see if we can remove one of them by computing the closure of each in turn.

                \begin{itemize}
                  \item $AB \rightarrow C$
                    \[\closure{A} = \{A\}\]
                    \[\closure{B} = \{B,E\}\]

                    Since neither of these closed over $C$ we cannot remove either from the left.
                  \item $CE \rightarrow A$
                    \[\closure{C} = \{C\}\]
                    \[\closure{E} = \{E\}\]

                    Since neither of these closed over $A$ we cannot remove either from the left.
                  \item $AC \rightarrow D$
                    \[\closure{A} = \{A\}\]
                    \[\closure{C} = \{C\}\]

                    Since neither of these closed over $D$ we cannot remove either from the left.
                \end{itemize}

                So, we cannot simplify the left sides of any of our FD's.

              \item
                We check to see if we can remove any FD's from the set by computing the closure of the left with the rest of the set.

                \begin{itemize}
                  \item $AB \rightarrow C$
                    \[\closure{A, B} = \{A, B, E\}\]

                    Since this did not close over $C$, we cannot remove this FD.
                  \item $B \rightarrow E$
                    \[\closure{B} = \{B\}\]

                    Since this did not close over $E$, we cannot remove this FD.
                  \item $CE \rightarrow A$
                    \[\closure{C, E} = \{C, E\}\]

                    Since this did not close over $A$, we cannot remove this FD.
                  \item $AC \rightarrow D$
                    \[\closure{A, C} = \{A, C\}\]

                    Since this did not close over $D$, we cannot remove this FD.
                \end{itemize}

                So, we cannot remove any FD's from the set.
            \end{itemize}

            Since we already have every right side being singleton,
            we cannot simplify the left sides of any of the FD's,
            and we cannot remove any FD's,
            this is a minimal basis.
          \end{proof}
        \item
          We start by looking at which of the FD's given violate BCNF.
          Since we know the keys are $\{\{A,B\}, \{B,C\}\}$,
          we know that $AB \rightarrow C$ and anything that follows from it will not violate BCNF,
          as these are all superkeys.

          This leaves the other FD's as violators of BCNF.
          These are $B \rightarrow E, CE \rightarrow A, AC \rightarrow D$.

          We now check each FD that follows from the above.
          N.B. If a FD that follows contains a superkey,
          we needn't compute the closure, as it will not violate BCNF.

          \begin{itemize}
            \item $B \rightarrow E$

              \begin{tabular}{c | c | c |}
                FD                    & Closure             & Violates BCNF \\
                \hline
                $BD \rightarrow E$    & $\{B, D, E\}$       & VIOLATES \\
                \hline
                $BE \rightarrow E$    & $\{B, E\}$          & VIOLATES \\
                \hline
                $BDE \rightarrow E$   & $\{B, D, E\}$       & VIOLATES \\
                \hline
              \end{tabular}

            \item $CE \rightarrow A$

              \begin{tabular}{c | c | c |}
                FD                    & Closure             & Violates BCNF \\
                \hline
                $ACE \rightarrow A$   & $\{A, C, D, E\}$    & VIOLATES \\
                \hline
                $CDE \rightarrow A$   & $\{A, C, D, E\}$    & VIOLATES \\
                \hline
                $ACDE \rightarrow A$  & $\{A, C, D, E\}$    & VIOLATES \\
                \hline
              \end{tabular}

            \item $AC \rightarrow D$

              \begin{tabular}{c | c | c |}
                FD                    & Closure             & Violates BCNF \\
                \hline
                $ACD \rightarrow D$   & $\{A, C, D\}$       & VIOLATES \\
                \hline
                $ACE \rightarrow D$   & $\{A, C, D, E\}$    & VIOLATES \\
                \hline
                $ACDE \rightarrow D$  & $\{A, C, D, E\}$    & VIOLATES \\
                \hline
              \end{tabular}
          \end{itemize}

          So, we have listed all of the FD's that follow which violate BCNF

        \item
          Given the violators above, we can decompose $R$ to BCNF relations.

          Start with $B \rightarrow E$.

          \[R_1(A, B, C, D), R_2(B, E)\]
          We have that $R_2$ is in BCNF as it is a 2-attribute relation with the key $\{B\}$.

          For $R_1$, we still have the FD's $AB \rightarrow C, AC \rightarrow D$,
          and only one of our previous keys---$\{A, B\}$---still holds.

          We check the closure of our FD's.

          \[\closure{AB} = \{A, B, C, D\}\]
          \[\closure{AC} = \{A, C, D\}\]

          So, our old violator---$AC \rightarrow D$---still exists.

          We decompose $R_1$ into
          \[R_3(A, B, C), R_4(C, D)\]
          We have that $R_4$ is in BCNF as it is a 2-attribute relation with the key $\{C\}$.

          For $R_3$, we still have the FD $AB \rightarrow C$, and our key is $\{A, B\}$.

          The closure can be computed to show this is in BCNF.
          \[\closure{AB} = \{A, B, C\}\]

          Thus, we have decomposed $R(A, B, C, D, E)$ into the BCNF relations:
          \[R_2(B, E), R_3(A, B, C), R_4(C, D)\]

        \item
          Using the charts generated before:

          \begin{itemize}
            \item $B \rightarrow E$

              \begin{tabular}{c | c | c |}
                FD                    & Closure             & Violates BCNF \\
                \hline
                $BD \rightarrow E$    & $\{B, D, E\}$       & VIOLATES \\
                \hline
                $BE \rightarrow E$    & $\{B, E\}$          & VIOLATES \\
                \hline
                $BDE \rightarrow E$   & $\{B, D, E\}$       & VIOLATES \\
                \hline
              \end{tabular}

            \item $CE \rightarrow A$

              \begin{tabular}{c | c | c |}
                FD                    & Closure             & Violates BCNF \\
                \hline
                $ACE \rightarrow A$   & $\{A, C, D, E\}$    & VIOLATES \\
                \hline
                $CDE \rightarrow A$   & $\{A, C, D, E\}$    & VIOLATES \\
                \hline
                $ACDE \rightarrow A$  & $\{A, C, D, E\}$    & VIOLATES \\
                \hline
              \end{tabular}

            \item $AC \rightarrow D$

              \begin{tabular}{c | c | c |}
                FD                    & Closure             & Violates BCNF \\
                \hline
                $ACD \rightarrow D$   & $\{A, C, D\}$       & VIOLATES \\
                \hline
                $ACE \rightarrow D$   & $\{A, C, D, E\}$    & VIOLATES \\
                \hline
                $ACDE \rightarrow D$  & $\{A, C, D, E\}$    & VIOLATES \\
                \hline
              \end{tabular}
          \end{itemize}

          We can see that the violators of 3NF are the ones whose right sides are not prime.

          Since the FD $CE \rightarrow A$ and each of its followers that violates BCNF contain a prime right side ($A$),
          we have the rest as violators of 3NF.

          That is:

          \begin{itemize}
            \item $B \rightarrow E$

              \begin{tabular}{c | c | c |}
                FD                    & Closure             & Violates 3NF \\
                \hline
                $BD \rightarrow E$    & $\{B, D, E\}$       & VIOLATES \\
                \hline
                $BE \rightarrow E$    & $\{B, E\}$          & VIOLATES \\
                \hline
                $BDE \rightarrow E$   & $\{B, D, E\}$       & VIOLATES \\
                \hline
              \end{tabular}

            \item $AC \rightarrow D$

              \begin{tabular}{c | c | c |}
                FD                    & Closure             & Violates 3NF \\
                \hline
                $ACD \rightarrow D$   & $\{A, C, D\}$       & VIOLATES \\
                \hline
                $ACE \rightarrow D$   & $\{A, C, D, E\}$    & VIOLATES \\
                \hline
                $ACDE \rightarrow D$  & $\{A, C, D, E\}$    & VIOLATES \\
                \hline
              \end{tabular}
          \end{itemize}

        \item
          We decompose $R$ by first creating relations of all the FD's:

          \[R_1(A, B, C), R_2(B, E), R_3(A, C, E), R_4(A, C, D)\]

          By definition these all have a minimal basis of the FD used to construct them.
          The keys of each relation is the left side of each FD.

          \begin{tabular}{c | c}
            Relation & Key \\
            \hline
            $R_1$    & $\{A, B\}$ \\
            $R_2$    & $\{B\}$ \\
            $R_3$    & $\{C, E\}$ \\
            $R_4$    & $\{A, C\}$ \\
          \end{tabular}

          None of these relations is a subset of another, so we needn't remove any.
          Furthermore, $R_1$ is a superkey for $R$, so we needn't add any more relations.

          Thus, we have decomposed $R$ into 3NF.

      \end{enumerate}
  \end{enumerate}
\end{document}
